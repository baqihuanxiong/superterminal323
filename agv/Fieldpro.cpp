#include "Fieldpro.h"

const String CMD_EMPTY = "f110r0";
const String CMD_HEAVY = "f110r0";
const String CMD_STOP = "f000r0";
const String CMD_RETREAT = "b110r0";

const int RETREAT_DISTANCE = 500; // 未得到区段情况下的后退距离

/*
 * 00:直行
 * 01:16-16左转
 * 02:16-16右转
 * 03:16-24左转
 * 04:16-24右转
 * 05:24-16左转
 * 06:24-16右转
 * 07:向左相邻换道
 * 08:向右相邻换道
 */
Procedure getZoneProcedure(int index) {
  if (index==0) {  // 直行
    static String p_cmds[1] = {"f100r0"};
    static int p_periods[2] = {0,0};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==1) {  // 16-16左转
    static String p_cmds[1] = {"f100r-58"};
    static int p_periods[2] = {50,1600};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==2) {  // 16-16右转
    static String p_cmds[1] = {"f100r58"};
    static int p_periods[2] = {50,1600};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==3) {  // 16-24左转
    static String p_cmds[1] = {"f100r-60"};
    static int p_periods[2] = {165,1660};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==4) {  // 16-24右转
    static String p_cmds[1] = {"f100r60"};
    static int p_periods[2] = {165,1660};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==5) {  // 24-16左转
    static String p_cmds[1] = {"f100r-60"};
    static int p_periods[2] = {495,1995};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==6) {  // 24-16右转
    static String p_cmds[1] = {"f100r60"};
    static int p_periods[2] = {495,1995};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 1;
    return p;
  }
  else if (index==7) {  // 向左相邻换道
    static String p_cmds[2] = {"f100r-48","f100r60"};
    static int p_periods[3] = {0,1055,1990};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 2;
    return p;
  }
  else if (index==8) {  // 向右相邻换道
    static String p_cmds[2] = {"f100r48","f100r-60"};
    static int p_periods[3] = {0,1055,1990};
    Procedure p;
    p.cmds = p_cmds;
    p.periods = p_periods;
    p.len = 2;
    return p;
  }
  
}

const byte rfidMap[548][4] = {
  {0,0,0,0},  // 1
  {80,241,92,115},  // 2
  {208,133,109,115},  // 3
  {0,103,108,115},  // 4
  {176,70,112,115},  // 5
  {64,42,122,115},  // 6
  {32,70,96,115},  // 7
  {128,144,126,115},  // 8
  {192,230,134,115},  // 9
  {0,117,116,115},  // 10
  {16,155,95,115},  // 11
  {64,167,100,115},  // 12
  {80,142,101,115},  // 13
  {64,255,106,115},  // 14
  {64,75,143,115},  // 15
  {192,235,136,115},  // 16
  {48,72,111,115},  // 17
  {192,75,141,115},  // 18
  {192,183,144,115},  // 19
  {176,17,103,115},  // 20
  {128,121,129,115},  // 21
  {192,135,104,115},  // 22
  {192,6,132,115},  // 23
  {16,153,116,115},  // 24
  {128,45,123,115},  // 25
  {240,2,138,115},  // 26
  {144,150,119,115},  // 27
  {176,133,115,115},  // 28
  {64,5,145,115},  // 29
  {144,21,113,115},  // 30
  {192,193,114,115},  // 31
  {240,220,125,115},  // 32
  {0,0,0,0},  // 33
  {176,230,111,115},  // 34
  {16,87,143,115},  // 35
  {32,218,131,115},  // 36
  {176,206,141,115},  // 37
  {224,24,118,115},  // 38
  {16,103,104,115},  // 39
  {48,185,104,115},  // 40
  {32,68,132,115},  // 41
  {80,95,109,115},  // 42
  {80,63,101,115},  // 43
  {192,174,130,115},  // 44
  {128,133,125,115},  // 45
  {80,187,88,115},  // 46
  {160,84,107,115},  // 47
  {192,88,105,115},  // 48
  {48,229,115,115},  // 49
  {0,228,117,115},  // 50
  {208,11,128,115},  // 51
  {16,251,105,115},  // 52
  {0,183,139,115},  // 53
  {32,215,141,115},  // 54
  {0,172,110,115},  // 55
  {224,100,103,115},  // 56
  {0,233,127,115},  // 57
  {64,191,129,115},  // 58
  {96,41,125,115},  // 59
  {80,90,112,115},  // 60
  {176,234,133,115},  // 61
  {128,84,107,115},  // 62
  {240,233,108,115},  // 63
  {224,98,131,115},  // 64
  {192,121,105,115},  // 65
  {0,208,123,115},  // 66
  {16,90,142,115},  // 67
  {208,74,102,115},  // 68
  {160,153,103,115},  // 69
  {48,126,121,115},  // 70
  {64,12,106,115},  // 71
  {96,19,116,115},  // 72
  {176,151,104,115},  // 73
  {80,193,129,115},  // 74
  {48,10,110,115},  // 75
  {224,226,104,115},  // 76
  {0,202,123,115},  // 77
  {64,41,116,115},  // 78
  {96,39,122,115},  // 79
  {96,37,106,115},  // 80
  {48,29,113,115},  // 81
  {208,12,111,115},  // 82
  {32,12,88,115},  // 83
  {16,251,97,115},  // 84
  {208,176,120,115},  // 85
  {16,127,106,115},  // 86
  {224,152,109,115},  // 87
  {16,62,106,115},  // 88
  {16,224,111,115},  // 89
  {32,100,106,115},  // 90
  {64,144,113,115},  // 91
  {192,185,98,115},  // 92
  {0,190,113,115},  // 93
  {64,23,102,115},  // 94
  {16,248,109,115},  // 95
  {32,43,114,115},  // 96
  {208,71,132,115},  // 97
  {32,192,122,115},  // 98
  {96,169,133,115},  // 99
  {80,54,142,115},  // 100
  {96,75,122,115},  // 101
  {112,222,101,115},  // 102
  {224,244,134,115},  // 103
  {224,185,105,115},  // 104
  {128,166,138,115},  // 105
  {48,145,111,115},  // 106
  {144,175,145,115},  // 107
  {144,89,110,115},  // 108
  {32,24,121,115},  // 109
  {32,19,146,115},  // 110
  {144,35,114,115},  // 111
  {80,200,141,115},  // 112
  {208,145,106,115},  // 113
  {192,234,87,115},  // 114
  {16,172,109,115},  // 115
  {192,93,131,115},  // 116
  {16,242,113,115},  // 117
  {176,6,114,115},  // 118
  {80,184,102,115},  // 119
  {80,207,140,115},  // 120
  {0,147,102,115},  // 121
  {32,79,104,115},  // 122
  {48,82,101,115},  // 123
  {208,136,133,115},  // 124
  {96,77,117,115},  // 125
  {0,135,145,115},  // 126
  {64,1,102,115},  // 127
  {0,24,90,115},  // 128
  {176,250,97,115},  // 129
  {128,107,110,115},  // 130
  {192,249,90,115},  // 131
  {224,129,115,115},  // 132
  {192,132,104,115},  // 133
  {80,158,115,115},  // 134
  {128,162,114,115},  // 135
  {128,113,134,115},  // 136
  {32,33,111,115},  // 137
  {32,155,109,115},  // 138
  {224,237,140,115},  // 139
  {192,240,89,115},  // 140
  {64,4,108,115},  // 141
  {16,201,114,115},  // 142
  {224,147,118,115},  // 143
  {16,242,143,115},  // 144
  {192,44,112,115},  // 145
  {48,248,103,115},  // 146
  {208,152,122,115},  // 147
  {64,86,127,115},  // 148
  {208,98,131,115},  // 149
  {112,0,94,115},  // 150
  {64,194,101,115},  // 151
  {64,193,131,115},  // 152
  {208,220,111,115},  // 153
  {176,60,104,115},  // 154
  {192,89,111,115},  // 155
  {80,243,101,115},  // 156
  {128,169,114,115},  // 157
  {0,181,109,115},  // 158
  {64,220,121,115},  // 159
  {224,63,102,115},  // 160
  {32,206,97,115},  // 161
  {176,179,121,115},  // 162
  {135,99,61,170},  // 163
  {80,84,103,115},  // 164
  {208,16,114,115},  // 165
  {64,49,141,115},  // 166
  {224,192,125,115},  // 167
  {96,248,136,115},  // 168
  {176,79,116,115},  // 169
  {0,65,119,115},  // 170
  {176,173,104,115},  // 171
  {32,69,115,115},  // 172
  {16,182,114,115},  // 173
  {64,27,114,115},  // 174
  {96,107,141,115},  // 175
  {192,10,106,115},  // 176
  {32,29,90,115},  // 177
  {176,200,125,115},  // 178
  {16,48,108,115},  // 179
  {144,96,106,115},  // 180
  {112,200,107,115},  // 181
  {224,222,108,115},  // 182
  {208,181,121,115},  // 183
  {80,102,115,115},  // 184
  {112,143,101,115},  // 185
  {128,85,115,115},  // 186
  {0,208,110,115},  // 187
  {64,134,115,115},  // 188
  {64,230,103,115},  // 189
  {112,105,95,115},  // 190
  {144,191,134,115},  // 191
  {128,35,142,115},  // 192
  {32,249,96,115},  // 193
  {80,143,120,115},  // 194
  {112,24,138,115},  // 195
  {48,186,144,115},  // 196
  {64,205,115,115},  // 197
  {112,30,109,115},  // 198
  {192,98,107,115},  // 199
  {224,108,135,115},  // 200
  {64,171,127,115},  // 201
  {240,42,110,115},  // 202
  {176,189,88,115},  // 203
  {240,223,124,115},  // 204
  {0,142,101,115},  // 205
  {144,193,143,115},  // 206
  {112,85,115,115},  // 207
  {176,11,132,115},  // 208
  {160,100,101,115},  // 209
  {144,237,106,115},  // 210
  {192,132,107,115},  // 211
  {144,110,126,115},  // 212
  {240,158,104,115},  // 213
  {208,94,111,115},  // 214
  {80,241,104,115},  // 215
  {224,90,102,115},  // 216
  {144,224,105,115},  // 217
  {112,170,130,115},  // 218
  {208,54,105,115},  // 219
  {224,199,113,115},  // 220
  {48,69,107,115},  // 221
  {208,181,105,115},  // 222
  {16,156,114,115},  // 223
  {240,163,101,115},  // 224
  {16,53,106,115},  // 225
  {80,88,105,115},  // 226
  {224,79,115,115},  // 227
  {32,8,119,115},  // 228
  {64,94,101,115},  // 229
  {0,253,109,115},  // 230
  {160,92,107,115},  // 231
  {48,105,104,115},  // 232
  {144,52,111,115},  // 233
  {32,94,112,115},  // 234
  {112,196,110,115},  // 235
  {64,27,138,115},  // 236
  {32,117,145,115},  // 237
  {0,76,106,115},  // 238
  {208,59,96,115},  // 239
  {80,214,118,115},  // 240
  {48,136,99,115},  // 241
  {0,214,110,115},  // 242
  {48,180,108,115},  // 243
  {208,175,140,190},  // 244
  {160,74,144,115},  // 245
  {240,149,111,115},  // 246
  {0,56,104,115},  // 247
  {48,21,104,115},  // 248
  {160,87,124,115},  // 249
  {128,137,110,115},  // 250
  {208,91,106,115},  // 251
  {208,244,107,115},  // 252
  {0,148,102,115},  // 253
  {240,147,132,115},  // 254
  {0,61,112,115},  // 255
  {240,220,144,115},  // 256
  {176,79,102,115},  // 257
  {32,248,116,115},  // 258
  {80,192,102,115},  // 259
  {160,19,120,115},  // 260
  {32,126,119,44},  // 261
  {224,18,140,115},  // 262
  {112,147,112,115},  // 263
  {32,34,103,115},  // 264
  {16,53,114,115},  // 265
  {160,92,108,115},  // 266
  {224,0,126,115},  // 267
  {192,55,105,115},  // 268
  {48,92,111,115},  // 269
  {16,230,103,115},  // 270
  {128,146,114,115},  // 271
  {48,6,117,115},  // 272
  {112,214,86,115},  // 273
  {32,179,108,115},  // 274
  {16,119,93,115},  // 275
  {112,168,94,115},  // 276
  {64,19,115,115},  // 277
  {0,78,109,115},  // 278
  {128,70,118,115},  // 279
  {240,131,93,115},  // 280
  {16,179,101,115},  // 281
  {128,40,102,115},  // 282
  {48,22,104,115},  // 283
  {192,10,107,115},  // 284
  {64,22,137,115},  // 285
  {16,82,117,115},  // 286
  {176,75,105,115},  // 287
  {64,37,115,115},  // 288
  {144,137,134,115},  // 289
  {80,99,90,115},  // 290
  {208,73,104,115},  // 291
  {208,161,112,115},  // 292
  {80,207,98,115},  // 293
  {176,129,110,115},  // 294
  {48,182,131,190},  // 295
  {208,90,126,115},  // 296
  {16,131,104,115},  // 297
  {224,102,131,115},  // 298
  {240,228,116,115},  // 299
  {176,230,138,115},  // 300
  {48,51,111,115},  // 301
  {240,16,146,115},  // 302
  {32,136,99,115},  // 303
  {80,53,110,115},  // 304
  {112,142,106,115},  // 305
  {112,207,86,115},  // 306
  {0,66,109,115},  // 307
  {112,76,110,115},  // 308
  {0,102,108,115},  // 309
  {128,55,111,115},  // 310
  {80,221,144,115},  // 311
  {176,4,132,115},  // 312
  {112,210,107,115},  // 313
  {208,241,137,115},  // 314
  {176,196,105,115},  // 315
  {160,231,138,115},  // 316
  {16,17,109,115},  // 317
  {16,49,105,115},  // 318
  {32,47,100,115},  // 319
  {32,236,101,115},  // 320
  {224,57,113,115},  // 321
  {240,101,144,115},  // 322
  {192,73,105,115},  // 323
  {160,197,136,115},  // 324
  {96,117,138,115},  // 325
  {128,102,104,115},  // 326
  {80,5,139,115},  // 327
  {64,123,137,115},  // 328
  {96,231,106,115},  // 329
  {208,205,113,115},  // 330
  {80,167,106,115},  // 331
  {96,204,113,115},  // 332
  {128,64,141,115},  // 333
  {80,24,246,80},  // 334
  {224,140,92,115},  // 335
  {80,170,130,190},  // 336
  {160,143,110,115},  // 337
  {96,52,4,97},  // 338
  {96,210,105,115},  // 339
  {96,132,155,190},  // 340
  {16,155,113,115},  // 341
  {32,47,115,44},  // 342
  {240,162,101,115},  // 343
  {48,223,118,44},  // 344
  {240,120,110,115},  // 345
  {240,220,142,190},  // 346
  {16,251,100,115},  // 347
  {48,176,149,190},  // 348
  {16,221,106,115},  // 349
  {192,175,123,115},  // 350
  {128,132,107,115},  // 351
  {224,20,108,115},  // 352
  {192,32,114,115},  // 353
  {0,57,109,115},  // 354
  {224,225,114,115},  // 355
  {0,173,107,115},  // 356
  {224,0,105,115},  // 357
  {112,11,120,115},  // 358
  {80,245,109,115},  // 359
  {176,103,104,115},  // 360
  {80,157,137,115},  // 361
  {144,195,106,115},  // 362
  {32,105,106,115},  // 363
  {144,17,90,115},  // 364
  {32,126,115,115},  // 365
  {64,34,133,115},  // 366
  {64,36,133,190},  // 367
  {16,56,114,115},  // 368
  {0,223,117,44},  // 369
  {224,137,103,115},  // 370
  {80,50,143,190},  // 371
  {32,216,131,115},  // 372
  {192,53,31,97},  // 373
  {32,91,112,115},  // 374
  {240,192,254,80},  // 375
  {192,103,107,115},  // 376
  {80,218,117,44},  // 377
  {192,88,103,115},  // 378
  {224,51,154,190},  // 379
  {48,73,126,115},  // 380
  {96,208,157,190},  // 381
  {176,154,93,115},  // 382
  {48,35,130,115},  // 383
  {112,153,109,115},  // 384
  {0,225,94,115},  // 385
  {0,38,108,115},  // 386
  {160,195,143,115},  // 387
  {32,213,145,115},  // 388
  {128,138,112,115},  // 389
  {64,68,115,115},  // 390
  {16,157,107,115},  // 391
  {176,1,133,115},  // 392
  {32,116,93,115},  // 393
  {112,155,86,115},  // 394
  {112,134,131,115},  // 395
  {16,83,118,115},  // 396
  {176,16,110,115},  // 397
  {160,67,145,115},  // 398
  {112,62,112,115},  // 399
  {112,247,134,190},  // 400
  {176,225,108,115},  // 401
  {208,33,246,80},  // 402
  {208,115,133,115},  // 403
  {96,134,144,190},  // 404
  {80,61,143,115},  // 405
  {0,139,134,190},  // 406
  {0,63,114,115},  // 407
  {144,105,123,44},  // 408
  {80,188,116,115},  // 409
  {64,170,137,44},  // 410
  {208,220,124,115},  // 411
  {192,140,35,97},  // 412
  {192,127,105,115},  // 413
  {16,219,129,190},  // 414
  {176,41,115,115},  // 415
  {160,240,134,190},  // 416
  {0,244,102,115},  // 417
  {240,60,122,115},  // 418
  {16,231,91,115},  // 419
  {192,16,107,115},  // 420
  {0,229,111,115},  // 421
  {0,13,107,115},  // 422
  {144,114,89,115},  // 423
  {80,43,114,115},  // 424
  {0,247,114,115},  // 425
  {128,146,126,115},  // 426
  {224,31,132,115},  // 427
  {240,183,112,115},  // 428
  {240,161,101,115},  // 429
  {112,7,130,115},  // 430
  {128,186,107,115},  // 431
  {208,245,115,115},  // 432
  {96,6,122,115},  // 433
  {32,178,111,115},  // 434
  {240,219,117,115},  // 435
  {48,241,107,115},  // 436
  {160,194,132,44},  // 437
  {16,161,108,115},  // 438
  {64,139,139,190},  // 439
  {128,109,108,115},  // 440
  {128,241,132,44},  // 441
  {192,254,130,115},  // 442
  {128,216,255,96},  // 443
  {192,34,142,115},  // 444
  {224,220,233,96},  // 445
  {48,223,144,115},  // 446
  {48,141,246,80},  // 447
  {176,38,96,115},  // 448
  {0,136,35,97},  // 449
  {224,216,107,115},  // 450
  {0,21,125,44},  // 451
  {160,131,139,115},  // 452
  {80,107,9,97},  // 453
  {192,89,131,115},  // 454
  {16,77,142,115},  // 455
  {0,2,141,115},  // 456
  {112,111,126,115},  // 457
  {144,178,142,115},  // 458
  {80,118,132,115},  // 459
  {48,209,115,115},  // 460
  {112,8,130,115},  // 461
  {32,48,87,115},  // 462
  {112,172,139,115},  // 463
  {48,90,108,115},  // 464
  {0,75,103,115},  // 465
  {160,158,101,115},  // 466
  {176,203,123,115},  // 467
  {96,132,109,115},  // 468
  {128,242,143,115},  // 469
  {208,30,139,115},  // 470
  {48,166,111,115},  // 471
  {96,60,118,115},  // 472
  {224,96,137,115},  // 473
  {32,112,103,115},  // 474
  {32,67,108,115},  // 475
  {48,93,142,115},  // 476
  {80,54,95,115},  // 477
  {112,94,133,115},  // 478
  {192,97,115,115},  // 479
  {64,218,104,115},  // 480
  {160,4,146,115},  // 481
  {224,216,101,115},  // 482
  {176,231,110,115},  // 483
  {128,159,105,115},  // 484
  {16,240,123,115},  // 485
  {112,54,123,115},  // 486
  {144,196,141,115},  // 487
  {176,26,126,115},  // 488
  {0,46,111,115},  // 489
  {48,38,138,115},  // 490
  {80,72,103,115},  // 491
  {144,147,94,115},  // 492
  {160,23,127,115},  // 493
  {192,126,105,115},  // 494
  {32,57,106,115},  // 495
  {128,49,124,115},  // 496
  {128,162,112,115},  // 497
  {48,68,107,115},  // 498
  {224,126,115,115},  // 499
  {96,148,106,115},  // 500
  {240,243,103,115},  // 501
  {48,69,105,115},  // 502
  {96,124,117,115},  // 503
  {16,224,114,115},  // 504
  {160,156,112,115},  // 505
  {160,101,115,115},  // 506
  {160,7,111,115},  // 507
  {112,68,107,115},  // 508
  {16,18,108,115},  // 509
  {192,244,107,115},  // 510
  {240,67,109,115},  // 511
  {224,128,103,115},  // 512
  {160,252,109,115},  // 513
  {144,4,102,115},  // 514
  {32,18,104,115},  // 515
  {0,193,123,115},  // 516
  {176,130,110,115},  // 517
  {160,176,144,115},  // 518
  {80,132,136,115},  // 519
  {176,186,101,115},  // 520
  {16,172,122,115},  // 521
  {64,3,145,115},  // 522
  {96,80,105,115},  // 523
  {208,210,113,115},  // 524
  {144,154,133,115},  // 525
  {144,94,92,115},  // 526
  {112,76,97,115},  // 527
  {144,87,114,115},  // 528
  {96,58,113,115},  // 529
  {16,135,139,115},  // 530
  {112,69,142,115},  // 531
  {64,90,111,115},  // 532
  {208,13,115,115},  // 533
  {64,122,112,115},  // 534
  {240,161,113,115},  // 535
  {16,31,116,115},  // 536
  {208,189,129,115},  // 537
  {0,105,114,115},  // 538
  {96,99,113,115},  // 539
  {96,161,118,115},  // 540
  {160,194,143,115},  // 541
  {112,58,123,115},  // 542
  {224,37,105,115},  // 543
  {144,90,101,115},  // 544
  {128,80,113,115},  // 545
  {208,228,89,115},  // 546
  {48,247,138,115},  // 547
  {32,50,133,115}  // 548
};

